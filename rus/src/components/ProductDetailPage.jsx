// src/pages/ProductDetailPage.jsx
import { useState } from "react";
import { useNavigate, useParams } from "react-router-dom";

import arrowFor from "@/assets/arrow_for.png";
import bgYellow from "@/assets/bg-yellow.svg";
import flourLinen from "@/assets/flour-linen (2).png";
import flourSesame from "@/assets/flour-sesame (2).png";
import oilLinen from "@/assets/oil-linen.png";
import oilMustard from "@/assets/oil-mustard.png";
import oilSesame from "@/assets/oil-sesame.png";
import oilSunflower from "@/assets/oil-sunflower.png";
import vector from "@/assets/Vector2.svg";

const productsData = [
  {
    id: 1,
    name: "ЛЬНЯНОЕ МАСЛО PREMIUM",
    image: oilLinen,
    badges: ["Стекло", "250 грамм"],
    description:
      "Льняное масло «Premium» — натуральный и очень полезный продукт, который получают путем прямого холодного отжима семян масличного льна, выращенного на Алтае - чистейшем уголке мира. Благодаря своим отменным целебным свойствам, льняное масло применяют во многих областях медицины и косметологии.",
    benefits: [
      "Здоровье сердечно-сосудистой системы: омега-3 жирные кислоты помогают снизить уровень холестерина, укрепляют сосуды и нормализуют давление.",
      "Нормализация работы пищеварительной системы: способствует улучшению моторики кишечника и нормализации ЖКТ.",
      "Улучшение состояния кожи и волос: витамин Е и антиоксиданты защищают клетки и улучшают состояние кожи и волос.",
      "Поддержка метаболизма и снижение веса: помогает сжигать жировые ткани и нормализовать обмен веществ.",
      "Противовоспалительный эффект: содержит вещества с противовоспалительными свойствами.",
      "Иммуномодулирующий эффект: укрепляет иммунитет благодаря жирным кислотам.",
      "Антистрессовый эффект: помогает нормализовать эмоциональное состояние.",
    ],
    usage: [
      "В кулинарии: Употреблять 1-2 столовые ложки в день, за 15-20 минут до еды. Добавлять в салаты, каши, гарниры, творог, кефир, йогурт. Не использовать для жарки, не нагревать.",
      "В косметологии: Использовать для смягчения кожи, в масках для лица и тела. Наносить на волосы (на 15-60 минут), затем смывать. Применять для ухода за повреждённой кожей: царапины, ожоги, укусы. Перед применением провести тест на аллергию.",
    ],
  },
  {
    id: 2,
    name: "ГОРЧИЧНОЕ МАСЛО PREMIUM",
    image: oilMustard,
    badges: ["Стекло", "250 грамм"],
    description:
      "Нерафинированное горчичное масло улучшает пищеварение и аппетит, укрепляет сердце и сосуды, нормализует давление и уровень холестерина, повышает иммунитет за счёт витаминов, помогает заживлению кожи, ран и ожогов, улучшает состояние кожи и волос, может облегчать симптомы простуды, поддерживает здоровье печени и нервной системы, снижает стресс, улучшает сон и помогает при артрите и подагре.",
    benefits: [
      "Горчичное масло стимулирует пищеварение и улучшает аппетит, укрепляет сердце и сосуды, нормализует давление, снижает уровень холестерина и улучшает состав крови. Оно повышает иммунитет благодаря витаминам (A, B6, D, E, K, PP), помогает заживлять кожу, раны, ожоги, улучшает состояние кожи и волос за счёт омега-3 и омега-6. Также поддерживает здоровье печени и нервной системы, помогает бороться со стрессом, бессонницей, облегчает симптомы артрита, подагры и простуды (по аюрведе).",
    ],
    usage: [
      "Горчичное масло широко используется в кулинарии: подходит для жарки, тушения, заправки салатов и приготовления различных блюд. При добавлении в тесто делает хлеб и пироги более мягкими и пышными. Однако при повышенной кислотности желудка, колитах и панкреатитах следует употреблять его с осторожностью, так как оно может вызывать изжогу.",
    ],
  },
  {
    id: 3,
    name: "КУНЖУТНОЕ МАСЛО PREMIUM",
    image: oilSesame,
    badges: ["Стекло", "250 грамм"],
    description:
      "Ценный диетический продукт, получают путем прямого холодного отжима. Подходит для приготовления салатных заправок. Оптимально для поддержки уровня холестерина, снижает риск развития сердечнососудистых заболеваний. В косметологии кунжутное масло — отлично увлажняет кожу, глубоко проникая в клетки эпидермиса, питает и очищает её, замедляя процесс старения.",
    benefits: [
      "Укрепление сердечно-сосудистой системы: снижает уровень холестерина, улучшает микроциркуляцию и помогает предотвращать атеросклероз.",
      "Поддержка пищеварения: укрепляет слизистую желудка и кишечника, способствует нормализации пищеварения.",
      "Улучшение состояния кожи: обладает противовоспалительным и увлажняющим действием, защищает кожу от ультрафиолета и помогает при дерматологических заболеваниях.",
      "Нормализация обмена веществ: способствует снижению веса и нормализации метаболизма.",
      "Поддержка при простудах: применяется для растираний и облегчения симптомов простуды и кашля.",
      "Укрепление иммунитета: помогает повысить защитные функции организма.",
      "Регулирует уровень сахара в крови и поддерживает женское здоровье.",
      "Состав: витамины A, C, E, PP, группы B, белки, углеводы, жирные кислоты омега-6 и омега-9.",
    ],
    usage: [
      "В кулинарии: Заправка для салатов и холодных блюд. Добавление в соусы и маринады (сочетается с соевым соусом, мёдом, специями). Добавление в готовые горячие блюда (перед подачей на стол). Не использовать для жарки — не переносит тепловую обработку.",
      "В косметологии: Очищение кожи и снятие макияжа. Увлажнение кожи лица, губ и тела. Уход за волосами — укрепление, питание, предотвращение ломкости. Основа для питательных масок для лица. Не использовать в большом количестве на волосы (может утяжелять).",
      "В народной медицине: Растирания при простуде и кашле. Прием внутрь при ангине и болезнях горла — по одной ложке в день. При гастрите — 2 раза в день по 2 чайные ложки натощак. Закапывание в уши при боли — по несколько капель подогретого масла. При истощении — по столовой ложке 3 раза в день.",
      "Важно: При использовании кунжутного масла обратите внимание на возможные аллергические реакции. Не заменяет медикаментозное лечение.",
    ],
  },
  {
    id: 4,
    name: "ПОДСОЛНЕЧНОЕ МАСЛО АРОМАТНОЕ",
    image: oilSunflower,
    badges: ["ПЭТ", "500 грамм"],
    description:
      "​Масло подсолнечное нерафинированное Ароматное — это натуральный продукт из жареной семечки, не содержащий ГМО, с приятным ярким ароматом, насыщенным вкусом. Нерафинированное подсолнечное масло богато витаминами F и Е, полезными жирными кислотами-Омега 6, Омега 9. Нерафинированное подсолнечное масло является полезным и незаменимым продуктом питания особенно в пост, подсолнечное масло хорошо сочетается с салатами, кашами, с разнообразными гарнирами.",
    benefits: [
      "Источник витаминов A, D, E, F, K, PP и группы B, а также кальция, магния, цинка и селена.",
      "Антиоксидантные свойства: защита клеток от повреждений свободными радикалами.",
      "Нормализация обмена веществ: помогает снижать уровень холестерина.",
      "Поддержка работы ЖКТ: обволакивает слизистые, улучшает работу желчного пузыря.",
      "Укрепление мышц и повышение эластичности тканей.",
      "Поддержка эндокринной и нервной систем, замедление процессов старения.",
      "Польза для кожи: линолевая кислота поддерживает иммунитет, молодость и упругость кожи.",
      "Поддержка зрения: витамин A.",
      "Улучшение усвоения кальция: витамин D.",
      "Нормализация свертываемости крови: витамин K.",
      "Снижение вредного холестерина: витамин F.",
      "Поддержка печени и желчного пузыря: выведение токсинов.",
    ],
    usage: [
      "В кулинарии: Заправка для салатов, соусов, маринадов, холодных закусок. Не использовать для жарки (низкая точка дымления ~107°C). Практически не используется в выпечке — меняет вкус блюда.",
      "В косметологии: Уход за кожей лица и тела — смягчение, питание, удаление черных точек. Маски для волос — укрепление, блеск.",
      "Другие способы использования: Для маринадов и смазки сковороды перед жаркой. Для обработки деревянных поверхностей и мебели.",
      "Хранение: Хранить в тёмном месте, вдали от тепла и света. После открытия употреблять в течение короткого времени.",
      "Альтернативы для жарки: Рафинированное или дезодорированное подсолнечное масло. Сливочное масло (средние температуры). Оливковое масло (низкие температуры). Масло авокадо (высокие температуры).",
      "Преимущества: Содержит больше полезных веществ, чем рафинированное масло. Яркий вкус и аромат. Способствует здоровью кожи и волос.",
    ],
  },
  {
    id: 5,
    name: "ЛЬНЯНАЯ МУКА PREMIUM",
    image: flourLinen,
    badges: ["Дой-пак", "250 грамм"],
    description:
      "​Мука льняная — содержит большое количество диетической клетчатки (до 30%), полиненасыщенных жирных кислот (Омега-3; Омега-9), растительных белков (до 50%) витаминами В1, В6, фолиевой кислотой, антиоксидантами (лигнаны), а также необходимыми для здоровья микроэлементами (калием, кальцием, магнием, цинком и др.) Нужно отметить высокую пищевую и биологическую ценность льняного белка, который по сбалансированности аминокислотного состава, превосходит белок многих зерновых и бобовых культур. при введении её в рацион питания человека, прежде всего способствует нормализации работы ЖКТ. Это связано с большим содержание в ей ценных пищевых волокон, стимулирующих перистальтику и деятельность ЖКТ.",
    benefits: [
      "Богата клетчаткой: улучшает пищеварение, выводит токсины, нормализует кишечник.",
      "Содержит омега-3 и омега-6: поддерживает здоровье сердца, сосудов, кожи и мозга.",
      "Источник белка и аминокислот: поддерживает обмен веществ и укрепляет ткани.",
      "Витамины группы B, A, E, магний, калий, железо, цинк: укрепление иммунитета и общее оздоровление.",
      "Антиоксидантные свойства: защита клеток, замедление старения.",
      "Способствует снижению веса: снижает аппетит, создаёт чувство сытости.",
      "Без глютена: подходит для людей с целиакией.",
      "Нормализует уровень сахара в крови: замедляет усвоение углеводов.",
      "Улучшает состояние кожи и волос.",
      "Снижает уровень плохого холестерина.",
      "Профилактика сердечно-сосудистых заболеваний.",
      "Очищает кишечник, поддерживает здоровую микрофлору.",
      "Помогает при запорах, диарее и проблемах с пищеварением.",
    ],
    usage: [
      "В кулинарии: Добавлять в выпечку (хлеб, пироги, печенье, блины) — до 10-20% от общего объёма муки. Использовать как панировку для котлет, рыбы, овощей. Добавлять в супы и соусы — для загущения и кремовой текстуры. В кашах и напитках — для приготовления каш и отваров.",
      "Для здоровья: Принимать с водой или кефиром перед сном — для снижения веса и очищения организма. Регулярное употребление — нормализация работы кишечника.",
      "Дополнительные советы: Можно добавлять в молоко, йогурт, фруктовый сок, мёд. Приготовить льняной отвар — заварить кипятком и настоять. Смешивать с другими видами муки для нужной текстуры. Экспериментировать с рецептами — подобрать свой способ употребления.",
    ],
  },
  {
    id: 6,
    name: "КУНЖУТНАЯ МУКА PREMIUM",
    image: flourSesame,
    badges: ["Дой-пак", "250 грамм"],
    description:
      "​​Кунжутная мука — это дробленое обезжиренное бланшированное семя черного кунжута, получаемое после отжима из него масла. Мука из кунжута не содержит глютен и идеально подойдет для низкоуглеводной диеты, спортивного и здорового питания, а также полезна для роста и полноценного развития детей. Если вы в поисках безглютеновой муки, то мука кунжутная это идеальная альтернатива пшеничной. Мука из семян кунжута является источником растительного белка, пищевых волокон и витаминов, при этом она содержит не большое количество жиров и углеводов. Ее используют как добавку при приготовлении супов, каш, соусов, протеиновых коктейлей. Заменяя 10-30% привычной муки на кунжутную, выпечка получается мягкой, рассыпчатой и полезной",
    benefits: [
      "​Высокое содержание кальция — больше, чем в молоке; укрепляет кости и зубы.",
      "Аминокислоты: гистидин (регенерация тканей), аргинин (рост мышц), триптофан (антистресс).",
      "Пищевые волокна — нормализуют пищеварение и очищают организм.",
      "Витамины группы B, E, D, T, PP — поддерживают работу эндокринной, нервной, мышечной, пищеварительной и сердечно-сосудистой систем.",
      "Минералы: железо, калий, магний, медь, сера, фосфор, цинк.",
      "Улучшает состояние кожи, волос и ногтей.",
      "Поддерживает здоровье эндокринной системы.",
      "Благоприятно влияет на сердце и сосуды (омега-3 и омега-6 жирные кислоты).",
      "Повышает физическую и умственную работоспособность.",
      "Может быть полезна при заболеваниях костей, суставов, печени, поджелудочной, диабете, анемии, астме, тахикардии, гельминтозе, язвах и хронических запорах.",
      "Стимулирует иммунитет.",
    ],
    usage: [
      "В чистом виде: Употреблять натощак или добавлять в чай, кофе, молочные напитки или йогурт.",
      "В кулинарии: Добавление в каши (гречка, пшено, овсянка и др.). В салаты — для орехового вкуса. Можно использовать для выпечки (пироги, печенье, кексы и др.). Использовать для панировки мяса, рыбы, овощей и грибов. Добавлять в соусы — для густоты и вкуса. В йогурты, творог, сметану — для пользы и вкуса.",
      "Дополнительные советы: Рекомендуется употреблять 1-2 столовые ложки в день. Хранить в сухом, прохладном месте в герметичной упаковке. Хорошо сочетается с мёдом, вареньем, джемом, сиропами. Можно использовать для приготовления тахини (пасты) — для соусов и намазок. Противопоказания: осторожно при заболеваниях вен.",
    ],
  },
];

// Текстовая "кнопка" назад
function BackToProductsText({ className = "" }) {
  const navigate = useNavigate();
  return (
    <div
      onClick={() => navigate("/products")}
      className={`inline-flex items-center gap-3 px-6 py-3 rounded-[24px] border cursor-pointer select-none transition hover:bg-[#1C3B3E]/10 ${className}`}
      style={{ borderColor: "#1C3B3E", color: "#1C3B3E" }}
    >
      <span className="flex items-center justify-center w-9 h-9 rounded-full">
        <img src={arrowFor} alt="назад" className="w-[36px] h-[36px]" />
      </span>
      <span className="text-lg font-semibold">Вернуться к продукции</span>
    </div>
  );
}

// Иконка (плюс/крест) с анимацией
const ToggleIcon = ({ open }) => (
  <span
    className={`flex items-center justify-center w-8 h-8 sm:w-12 sm:h-12 rounded-xl border border-[#D7B56D] bg-[#142D30]
      transition-shadow duration-300 ${
        open ? "shadow-[0_0_20px_rgba(215,181,109,0.25)]" : ""
      }`}
    aria-hidden="true"
  >
    <span className="relative block ">
      <span
        className={`absolute left-1/2 top-1/2 block w-4 h-[2px] sm:w-6 sm:h-[2px] -translate-x-1/2 -translate-y-1/2 bg-[#D7B56D]
          transition-transform duration-300 ease-out ${
            open ? "rotate-45" : "rotate-0"
          } group-hover:scale-105`}
      />
      <span
        className={`absolute left-1/2 top-1/2 block w-4  sm:w-6 h-[2px] -translate-x-1/2 -translate-y-1/2 bg-[#D7B56D]
          transition-transform duration-300 ease-out ${
            open ? "-rotate-45" : "rotate-90"
          } group-hover:scale-105`}
      />
    </span>
  </span>
);

// Универсальный раздел-аккордеон с анимацией открытия
function AccordionSection({ title, open, onToggle, children }) {
  return (
    <div
      className={` w-full rounded-[32px] border border-[#D7B56D] overflow-hidden bg-[#1C3B3E] text-[#F7E8B0] transition-shadow duration-300 ${
        open ? "shadow-[inset_0_0_30px_rgba(215,181,109,0.20)]" : ""
      }`}
      // ширину не фиксируем — пусть совпадает с контейнером
    >
      <button
        onClick={onToggle}
        className="group  w-full h-[80px] sm:h-[120px] px-6 flex items-center justify-between text-left"
      >
        <h2 className="ml-3 sm:ml-10 text-[20px] sm:text-[27px] lg:text-[32px] text-[#D7B56D] font-lato font-semibold">
          {title}
        </h2>
        <ToggleIcon open={open} />
      </button>

      {open && (
        <div className="ml-5 sm:ml-10 2xl:ml-12 px-3 xl:px-6 font-light text-[13px] sm:text-[17px] lg:text-[20px] text-[#D7B56D] -mt-4 sm:-mt-8 pb-4 animate-accordion-in">
          {children}
        </div>
      )}
    </div>
  );
}

export default function ProductDetailPage({ idOverride }) {
  const { id } = useParams();
  const [expandedSection, setExpandedSection] = useState(null);

  const numericId = typeof idOverride === "number" ? idOverride : Number(id);
  const product = productsData.find((p) => p.id === numericId);

  if (!product) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-3xl font-bold mb-4">Продукт не найден</h1>
          <BackToProductsText />
        </div>
      </div>
    );
  }

  const toggleSection = (section) =>
    setExpandedSection(expandedSection === section ? null : section);

  return (
    <>
      {/* Локальные keyframes */}
      <style>{`
        @keyframes accordion-in {
          0%   { opacity: 0; transform: translateY(-6px) scaleY(0.98); }
          60%  { opacity: 1; transform: translateY(-2px) scaleY(1.005); }
          100% { opacity: 1; transform: translateY(0)    scaleY(1); }
        }
        .animate-accordion-in {
          animation: accordion-in .35s ease-out both;
        }
      `}</style>

      <div
        className="min-h-screen bg-no-repeat bg-cover pb-7 sm:pb-0 overflow-hidden"
        style={{
          backgroundImage: `url(${bgYellow})`,
          backgroundSize: "cover",
          backgroundPosition: "center",
        }}
      >
        {/* ЕДИНЫЙ КОНТЕЙНЕР С ТЕМИ ЖЕ ОТСТУПАМИ, ЧТО И НА СТРАНИЦЕ СПИСКА */}
        <div className="max-w-[1550px] mx-auto px-4 sm:px-6 lg:px-5">
          {/* Орнамент (верх) */}
          <div className="hidden sm:flex w-full justify-center">
            <img
              src={vector}
              alt="Орнамент"
              className="w-full mt-7 max-w-[1520px] h-auto lg:h-[34px]"
            />
          </div>

          {/* Кнопка назад */}
          <BackToProductsText className="mb-8 mt-6" />

          {/* Внешний бордер */}
          <div className="mb-5 sm:mb-8 bg-[#1C3B3E] border border-[#D7B56D] rounded-[32px] p-6 sm:p-8 lg:p-10 text-[#F7E8B0]">
            <h1 className="text-[20px] sm:text-4xl lg:text-[48px] bg-gradient-to-r from-[#7C622B] to-[#FFD170] bg-clip-text text-transparent font-lato font-bold mb-6 lg:mb-8">
              {product.name}
            </h1>

            {/* Внутренний бордер */}
            <div className="border border-[#D7B56D] rounded-[32px] p-5 sm:p-6 lg:p-8 flex flex-col lg:flex-row">
              {/* Фото */}
              <div
                className={`flex-shrink-0 flex justify-center items-center ${
                  product.name.toLowerCase().includes("мука")
                    ? "w-full lg:w-[320px]"
                    : "w-full lg:w-[200px]"
                }`}
              >
                <img
                  src={product.image}
                  alt={product.name}
                  className="max-w-full h-auto object-contain max-h-[300px] sm:max-h-[400px]"
                />
              </div>

              {/* Текстовая часть */}
              <div className="flex flex-col justify-start lg:ml-10 mt-6 lg:mt-0">
                {/* Бейджи */}
                {Array.isArray(product.badges) && product.badges.length > 0 && (
                  <div className="flex flex-wrap gap-3 mb-6">
                    {product.badges.map((b, i) => (
                      <span
                        key={i}
                        className="bg-[#D7B56D] text-[#1C3B3E] rounded-full text-[14px] px-6 py-2"
                      >
                        {b}
                      </span>
                    ))}
                  </div>
                )}

                <p className="text-[14px] sm:text-lg lg:text-[22px] font-lato font-light text-[#D7B56D] leading-relaxed">
                  {product.description}
                </p>
              </div>
            </div>
          </div>

          {/* Польза */}
          <div className="mb-4">
            <AccordionSection
              title={`Польза ${
                product.name.toLowerCase().includes("мука") ? "муки" : "масла"
              }`}
              open={expandedSection === "benefits"}
              onToggle={() => toggleSection("benefits")}
            >
              <ul className="list-disc pl-5 space-y-2">
                {product.benefits.map((benefit, index) => (
                  <li key={index}>{benefit}</li>
                ))}
              </ul>
            </AccordionSection>
          </div>

          {/* Применение */}
          <div className="">
            <AccordionSection
              title={`Применение ${
                product.name.toLowerCase().includes("мука") ? "муки" : "масла"
              }`}
              open={expandedSection === "usage"}
              onToggle={() => toggleSection("usage")}
            >
              <ul className="list-disc pl-5 space-y-2 ">
                {product.usage.map((use, index) => (
                  <li key={index}>{use}</li>
                ))}
              </ul>
            </AccordionSection>
          </div>
        </div>

        {/* Орнамент (низ) — выровнен теми же отступами/шириной */}
        <div className="hidden sm:flex w-full justify-center">
          <img
            src={vector}
            alt="Орнамент"
            className="w-full mt-10 mb-10 px-[24px] max-w-[1550px] h-auto lg:h-[34px]"
          />
        </div>
      </div>
    </>
  );
}
